#Weather API
1. This api is responsible for getting weather information given a city and country.
2. The api fetches the weather description from openweathermap api and stores the information in an in memory h2 database.
3. Any request to get weather information will be first looked up in the database and if not found a request will be sent to open weathermap api.
4. The api specification is autogenerated using swagger and can be found at http://localhost:8080/swagger-ui.html
5. The api also provide metrics for request and response status and timings using prometheus at http://localhost:8080/actuator/prometheus
6. The api supports rate limiting using bucket4j to protect DDOS attacks and resource usage overload.
7. The api provides rate limiting per api key and has 5 keys configured to allow receiving 5 requests per hour. It retuns a 429 too many requests
in case the api requests per key are exceeded in a given time period.
8. The application is supplied with a temporary openweathermap key, please use your own key as the given key will be deactivated shortly.

##The api supports the following endpoints
1. `GET /weather/description` - returns the description of the weather in a given city and country.

###Infrastructure
1. The project uses docker to containerise the application.
2. This allows the application to be platform-agnostic and can be deployed across cloud and datacenter
3. It also opens up options to deploy to container orchestration engines like Kubernetes

###Framework
1. The project is built using spring boot 2.0 as the framework and java 11 as the programming language.
2. The project uses embedded h2 as the database.
3. Ehcache is used for rate limiting with bucket4j.
4. The build tool used is Gradle

###Observability
1. Slf4j has been used to perform logging.
2. Prometheus along with micrometer has been used to instrument application metrics.
3. Documentation has been managed via Swagger 2.0

###Performance
1. We could have also used reactive programming using webflux, but springr2dbc doesnt provide full ORM features
   hence a tradeoff has been made between ORM vs high concurrency.
2. Hence, the project using Bucket4j for api rate limiting, when the user sends more than the allowed number of requests for
   a given duration and 429 too many requests error is thrown
3. This api can be hosted behind an API gateway like AWS API gateway or Kong to further provide rate limiting features.

###System requirements
1. Java 11
2. Gradle
3. Docker

###Building the project
Gradle has been used to build this api and the following command can be used to build the project
`./gradlew clean build`

###Testing the project
test cases for the api can be run using maven
`./gradlew test`

###Running the project
1. `./gradlew bootRun`
2. In a tool like postman or the browser, hit http://localhost:8080/weather/description?city=London&country_code=UK
3. The X-api-key "USER001" can be used to view the information and is to supplied as a header.

###Containerise the project
1. The following commands can be run in a build pipeline to build the docker container
2. `./gradlew clean build`
3. `docker build --build-arg JAR_FILE=build/libs/\*.jar -t vikram-vanguard/weather-api-docker .`
4. `docker run -p 8080:8080 vikram-vanguard/weather-api-docker`